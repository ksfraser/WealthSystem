<VirtualHost *:80>
    ServerName localhost
    ServerAdmin admin@localhost
    
    DocumentRoot /var/www/stock-analysis/web_ui
    
    <Directory /var/www/stock-analysis/web_ui>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        
        <FilesMatch \.php$>
            SetHandler application/x-httpd-php
        </FilesMatch>
        
        Options -Indexes
        
        Header always set X-Content-Type-Options "nosniff"
        Header always set X-Frame-Options "SAMEORIGIN"
        Header always set X-XSS-Protection "1; mode=block"
        Header always set Referrer-Policy "strict-origin-when-cross-origin"
    </Directory>
    
    Alias /api /var/www/stock-analysis/api
    <Directory /var/www/stock-analysis/api>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>
    
    <DirectoryMatch "/var/www/stock-analysis/(config|scripts|vendor|tests|database|deployment)">
        Require all denied
    </DirectoryMatch>
    
    <FilesMatch "^\.">
        Require all denied
    </FilesMatch>
    
    <FilesMatch "(composer\.json|composer\.lock|\.env|requirements\.txt)">
        Require all denied
    </FilesMatch>
    
    ErrorLog ${APACHE_LOG_DIR}/stock-analysis-error.log
    CustomLog ${APACHE_LOG_DIR}/stock-analysis-access.log combined
    
    RewriteEngine On
    RewriteCond %{REQUEST_URI} ^/api/
    RewriteRule ^api/(.*)$ /var/www/stock-analysis/api/$1 [L]
    
    SetEnv APP_ENV production
    SetEnv APP_ROOT /var/www/stock-analysis
    SetEnv PYTHON_PATH /var/www/stock-analysis/venv/bin/python
</VirtualHost>
